# HW3
## PB17111614 王嵘晟
### 1.考虑一个由L1 和L2 数据缓存组成的两级存储器层次结构.假定两个缓存在写入命中时都使用写回策略,两者的块大小相同.列出在一下事件时采取的操作.
#### a.当缓存组织方式为包含式层次结构时,发生L1 缓存缺失(miss)
>由于 L1 和 L2 的块大小相同，当 L1 miss 时，如果在 L2 中命中了，则从 L2 中拷贝相应的块到 L1 中。如果 L2 也没有命中，则从更低级拷贝相应的块，写入 L1 和 L2。
#### b.当缓存组织方式为互斥式层次结构时,发生L1 缓存缺失
>在 L1 中 miss，当在 L2 中 hit 时，L1 与 L2 中对应的块将发生互换。如果在 L1 与 L2 中均 miss，则从更底层拷贝相应的块到 L1 中，并将 L2 中对应的块用 L1 中的块替换。
#### c.在(a)部分和(b)部分中,考虑被替换的块是脏块的可能性(需要更新和不需要更新的可能性)
>对于a来说，如果 L2 hit，从 L2 拷贝相应的块到 L1 中。当 L1 中需要被替换的块是脏块时，将 L1 中该块原本的值写回到主存中。当这一块不是脏块时，直接替换该块，并将标志位改为脏块。当 L2 也没有命中，则从更低级拷贝相应的块，写入 L1 和 L2，若需要替换的 L1 中的块是脏块时，则需要将原值写回主存。当需要替换的 L2 中的块是脏块时，直接替换即可。  
对于b来说，如果 L2 hit，L1 与 L2 中相应的块互换。由于写回策略，当被替换的块是脏块时，块内原来的值都要写回主存中。（但这里我认为 L1 与 L2 中相应的块做了替换，可以不写回主存）如果在 L1 与 L2 中均 miss，则从更底层拷贝相应的块到 L1 中，并将 L2 中对应的块用 L1 中的块替换。如果这时被替换的 L1 与 L2 中的块为脏块时，需要将原来的值写回到主存中。
### 2.每当计算机空闲时,既可以将其置于待机状态(DRAM 仍然处于活动状态),也可以让他休眠.为了使其进入休眠状态,假定必须仅将DRAM 的内容复制到永久性介质中,比如闪存中,如果将大小为64 字节的缓存行读写至闪存需要2.56μJ,读写至DRAM 需要0.5nJ,如果8GB DRAM 空闲功耗为1.6W,那么一个系统空闲多长时间后才能从休眠中获益?假定主存储器的容量为8GB
>想要从休眠中获益，则通过休眠消耗能量应该&ge;空闲所消耗的能量。设休眠时间为t，有：  
(2&times;2^30)/64&times;2.56&times;10^(-6)&times;2 &le; 1.6t  
解得 t&ge;429.5 s，所以至少休眠429.5s后才能从休眠中获益。
### 3.考虑在L2 缓存缺失时使用关键字优先和提前重启动。假定L2 缓存的容量为1 MB、块大小为64 字节、填充路径宽16 字节。假定能够以每4 个处理器周期16 个字节的速度写入L2，从存储器控制器接收前16 个字节块的时间为120 个周期，每从主存储器接收另外16 个字节的块需要16 个周期，也可以直接将数据传送给L2 缓存的读取端口。忽略向L2 缓存发送缺失请求及向L1 缓存传送被请求数据的周期数。
#### a.在使用、不使用关键字优先和提前重启动时，为L2 缓存缺失提供服务分别需要多少个周期?
>使用关键字优先时，为L2缓存缺失提供服务时由写入前16个字节块直接完成，所以需要120个周期。不使用时，总周期=120+(64-16)/16*16=168个
#### b.你是否认为关键字优先和提前重启动对于L1 缓存或L2 缓存更重要一些,哪些因素影响着它们的相对重要性?
>是，L1 和 L2 两级缓存miss对于 AMAT 的增加以及关键字优先和提前重启动所提供的处理 miss 时间减少的百分比会影响相对重要性。如果关键字优先和提前重启动带来的 miss 时间减少的百分比与 L1 和 L2 miss 带来的 AMAT 增加量大致相同，则如果 L1 miss对 AMAT 的影响更大，则关键字优先和提前重启动对 L1 缓存影响更大。